# VulnShop - Web安全漏洞靶场

VulnShop是一个专门用于Web安全测试和学习的靶场应用，包含多种常见的Web安全漏洞。该项目基于Spring Boot开发，模拟了一个简单的电子商务网站。

## 运行方法
如需运行项目，直接在vulnshop目录下执行mvn spring-boot:run即可
```
cd vulnshop
mvn spring-boot:run
```
访问
前端 localhost:8080 他会占用你的8080端口
后台 localhost:8080/admin/login

## 包含的漏洞类型

### 1. SQL注入漏洞

- **用户搜索**: 在后台管理的用户搜索功能中，存在SQL注入漏洞，可以通过输入特殊字符如 `' OR '1'='1` 来获取所有用户信息。
- **商品搜索**: 在后台管理的商品搜索功能中，同样存在SQL注入漏洞，可以通过构造恶意SQL语句来获取或修改数据库信息。

### 2. XSS跨站脚本漏洞

- **商品名称和描述**: 添加商品时，商品名称和描述字段存在存储型XSS漏洞，可以插入JavaScript代码，如 `<script>alert('XSS')</script>` 或 `<img src=x onerror="alert('XSS')">` 等。
- **前端展示**: 商品列表页面在展示商品信息时未对内容进行HTML转义，导致存储型XSS漏洞。

### 3. 文件上传漏洞

- **商品图片上传**: 商品图片上传功能未对文件类型进行严格限制，可以上传任意类型的文件，包括可执行文件如 `.jsp`、`.php` 等，从而导致远程代码执行风险。
- **原始文件名保留**: 上传的文件保留原始文件名，未进行重命名或过滤，增加了安全风险。

### 4. CSRF跨站请求伪造漏洞

- **表单提交**: 添加商品等表单未使用CSRF令牌进行保护，容易受到跨站请求伪造攻击。
- **会话管理**: 虽然使用了Cookie进行会话管理，但未实施完整的CSRF防护机制。

### 5. 命令执行漏洞

- **系统命令执行**: 在后台仪表盘的系统信息页面中，存在一个可以直接执行系统命令的功能，未对输入进行任何过滤或限制，可以执行任意系统命令。

### 6. SSRF服务器端请求伪造漏洞

- **图片URL**: 添加商品时可以指定图片URL，但未对URL进行验证，可能导致服务器端请求伪造攻击，如访问内网资源。

## 安全使用说明

本项目仅用于安全学习和测试目的，请勿在生产环境中使用。在使用本靶场时，请确保：

1. 在隔离的环境中运行，如本地开发环境
2. 不要将其部署到公网或生产服务器上
3. 了解各种漏洞的原理和危害，以便更好地学习如何防范

## 最近更新内容

1. 完善后台添加商品功能，包括表单设计和数据处理
2. 添加多种安全漏洞，包括SQL注入、XSS、文件上传、CSRF、命令执行和SSRF等
3. 为每个漏洞添加提示和示例，方便学习和测试
4. 优化后台页面布局和交互体验
5. 添加商品搜索功能，并故意引入SQL注入漏洞
6. 添加系统命令执行功能，演示命令注入漏洞

## 后续计划

1. 添加更多类型的漏洞，如XXE、反序列化等
2. 提供漏洞修复指南，展示如何正确防范各类安全问题
3. 添加难度级别，从简单到复杂的漏洞利用场景
4. 完善前台购物功能，增加更多业务场景下的安全问题

# 开发计划
1.1 前端页面（仿京东）
首页：首页轮播图、顶部红色导航、左侧分类、商品卡片、公告栏（XSS）、热销推荐
商品列表页：分类筛选、价格区间、排序、搜索（SQL注入）
商品详情页：大图、参数、描述、评论区（XSS）、加入购物车（CSRF）、立即购买
购物车页：商品列表、数量修改（逻辑漏洞）、删除、结算（CSRF）
订单结算页：收货地址（SQL注入）、支付金额可篡改（逻辑漏洞）
用户中心：个人信息、收货地址管理、我的收藏、我的评论、头像上传（文件上传漏洞）
登录/注册页：SQL注入、XSS（昵称）、验证码绕过
后台管理（可选）：信息泄露、越权
1.2 后端漏洞点分布
SQL注入：商品搜索、登录、注册、订单查询、地址管理等
XSS：评论、公告栏、昵称、商品描述
CSRF：购物车操作、下单、地址添加、评论
文件上传：头像、商品图片
逻辑漏洞：订单金额篡改、越权访问、未登录可下单
信息泄露：异常堆栈、敏感信息返回
1.3 漏洞点提示
每个页面/接口都加显著提示，方便靶场用户测试

# 开发进度

### 2024-06-09
- 使用Spring Boot 3和Maven 3初始化了项目。
- 配置了`pom.xml`，集成Spring Boot、Spring Web、Spring Data JPA、H2数据库、Thymeleaf等依赖。
- 创建了`application.yml`，配置H2内存数据库、JPA、Thymeleaf和端口。
- 编写了`data.sql`，初始化了用户、商品、订单三张表及测试数据。
- 创建了Spring Boot主类`VulnshopApplication`。

### 2024-06-09（进度2）
- 创建了User、Product、Order实体类，分别对应users、products、orders三张表。
- 创建了UserRepository、ProductRepository、OrderRepository，基于Spring Data JPA实现数据访问。

### 2024-06-09（进度3）
- 创建了UserController，包含存在SQL注入漏洞的登录接口（/user/login）。
- 创建了ProductController，包含存在SQL注入漏洞的商品搜索接口（/product/search）。
- 创建了OrderController，包含存在SQL注入漏洞的订单查询接口（/order/list）。
- 所有接口均通过拼接SQL字符串，便于靶场演示SQL注入攻击。

### 2024-06-09（进度4）
- 数据库已由H2切换为MySQL。
- 依赖已更换为mysql-connector-j。
- application.yml已配置MySQL连接，默认用户名root，密码123456，数据库名vulnshop。
- 请确保本地已安装MySQL并创建vulnshop数据库。

### 2024-06-09（进度5）
- 新增Thymeleaf页面：login.html、products.html、product_detail.html、orders.html、order_detail.html。
- 控制器已支持页面渲染，所有注入点均有页面提示。
- 支持场景：登录、商品搜索、商品详情、订单查询、订单详情。
- 体验更贴近真实商场，便于SQL注入演练。

### 2024-06-10
- 对所有主要页面（登录、商品列表、商品详情、订单列表、订单详情）进行了美化，采用白蓝色简洁现代风：
  - 增加统一的顶部导航栏
  - 页面内容卡片化、圆角和阴影
  - 按钮风格统一，主色为蓝色
  - 注入点提示更显眼
  - 增加统一页脚

### 2024-06-10（进度2）
- 添加了4个新商品：高级钢笔、琥珀色精油瓶、黄金首饰套装、工装靴
- 扩展了products表结构，增加了description、stock、image_url字段
- 美化了商品列表页面，支持图片展示、悬停效果
- 美化了商品详情页面，支持大图展示和详细信息
- 创建了商品图片目录：/static/images/products/

### 2024-06-10（进度3）
- 创建了首页(index.html),展示热门商品和登录入口
- 修改了商品详情页,添加了登录检查和购物车功能
- 美化了登录页面,支持登录后跳转回原页面
- 创建了Product实体类和ProductRepository接口
- 创建了IndexController处理首页请求
- 完善了页面导航,根据登录状态显示不同菜单

### 2024-06-10（进度4）
- 修复了登录功能：创建了User实体类和UserRepository，添加了登录控制器
- 实现了购物车功能：创建了CartItem实体类、CartItemRepository和CartController
- 添加了购物车页面，支持查看购物车、删除商品
- 修改了数据库结构，添加了cart_items表
- 完善了登录后的页面跳转功能

### 2024-06-10（进度5）
- 优化了首页设计：
  - 添加了商品轮播图展示
  - 改进了导航栏样式，添加了图标
  - 美化了商品卡片展示
  - 优化了页面配色和布局
  - 添加了无障碍支持
- 完善了页面响应式设计，支持移动端访问

### 2024-06-10（进度6）
- 调整了路由结构：
  - 将原本的首页(/products)改为商品列表页
  - 将登录页面设为网站首页(/)
  - 更新了所有页面的导航链接
  - 重命名了IndexController为ProductController
- 优化了登录流程：
  - 登录成功后默认跳转到商品列表页
  - 保留了登录后跳转回原页面的功能

7. 修复路由冲突(2024-03-xx):

- 删除了旧的UserController
- 统一使用ProductController处理根路径

6. 修复实体类冲突(2024-03-xx):

- 删除model包中的重复Product类
- 统一使用entity包中的Product类作为商品实体

5. 修复包结构问题(2024-03-xx):

- 统一使用com.example.vulnshop作为基础包名
- 删除重复的VulnshopApplication类
- 整理项目结构，确保所有类都在正确的包下

4. 简化项目结构(2024-03-xx):

- 移除了所有登录相关功能
- 将根路径(/)重定向到商品列表页面(/products)
- 修复了实体类的JPA依赖问题(javax.persistence -> jakarta.persistence)
- 项目更专注于SQL注入漏洞练习

## 2025-05-24

解决控制器路径冲突问题：

- UserController和ProductController都映射了根路径"/"，导致启动失败
- 修改了UserController，删除了根路径"/"映射
- 保留了"/login"路径映射到登录页面，移除了重定向方法
- 现在根路径"/"由ProductController处理，会重定向到"/products"

## 2025-05-24（补充）

解决商品不显示问题和登录模板缺失问题：

- 创建了login.html模板文件，实现用户登录界面
- 实现了ProductServiceImpl中的商品相关方法（之前为空）
- 添加了示例商品数据，当数据库为空时自动创建
- 实现了商品搜索和商品详情功能

## 2024-06-11

添加后台管理功能：

- 创建了AdminController，包含后台管理各项功能和SQL注入漏洞点
- 添加了后台管理页面模板：
  - 登录页面(admin/login.html)
  - 管理布局模板(admin/layout.html)
  - 仪表盘页面(admin/dashboard.html)
  - 用户管理页面(admin/users.html)，含SQL注入漏洞点
  - 商品管理页面(admin/products.html)
  - 订单管理页面(admin/orders.html)
- 修改数据库结构，添加is_admin字段区分管理员用户
- 在前台首页导航栏中添加后台管理入口链接
- 实现了后台管理权限验证和登录功能

## 2024-06-12

重构后台管理代码，提高代码质量和鲁棒性：

- 重构了AdminController，添加了异常处理、日志记录和代码注释
- 创建了AdminService接口和AdminServiceImpl实现类，将业务逻辑从控制器移到服务层
- 创建了DashboardStatsDTO用于封装仪表盘统计数据
- 修改了查询方法，使用Number.class代替Long.class接收COUNT查询结果，解决类型转换问题
- 优化了所有后台管理页面，添加了错误信息显示区域
- 添加了适当的空值处理和异常捕获，提高了系统的稳定性
- 完善了SQL注入靶场的错误提示，便于教学演示

## 2024-06-13

优化后台登录验证逻辑：

- 使用Cookie替代Session进行管理员身份验证，增强安全性
- 在User实体类中添加isAdmin字段，用于区分管理员用户
- 修改UserRepository，添加安全的参数化查询方法findAdminByUsernameAndPassword
- 重构AdminController，使用Cookie进行身份验证，并添加getAuthenticatedAdminId方法
- 优化AdminServiceImpl中的searchUsers方法，使用参数化查询防止SQL注入
- 更新后台登录页面，添加关于Cookie验证的安全提示
- 实现安全的Cookie管理，包括设置HttpOnly和路径限制
- 完善登出逻辑，确保正确清除Cookie和会话令牌

## 2024-06-14

完善后台添加商品功能，添加更多种类的漏洞：

- 创建添加商品表单页面(admin/add-product.html)
- 在AdminController中添加处理商品添加的方法
- 添加文件上传漏洞，允许上传任意文件类型
- 添加XSS漏洞，不过滤商品名称和描述
- 添加CSRF漏洞，表单不使用CSRF令牌
- 添加SSRF漏洞，不验证图片URL
- 添加命令执行漏洞，允许通过特定URL参数执行系统命令
- 添加商品搜索功能，故意引入SQL注入漏洞
- 为每个漏洞添加明显的提示和示例，方便学习和测试

